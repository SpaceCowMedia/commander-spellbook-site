name: "Startup Backend"
description: "Clone and run the backend service using docker compose"

inputs:
  port:
    required: true
    description: "The port on which the backend service will be accessible"
    default: "8000"

runs:
  using: composite
  steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@v6
      with:
        repository: "SpaceCowMedia/commander-spellbook-backend"
        ref: latest
        path: backend
    - name: Build Backend ğŸ—
      working-directory: ./backend
      shell: bash
      run: docker compose build
    - name: Start Backend ğŸš€
      env:
        PORT: ${{ inputs.port }}
      working-directory: ./backend
      shell: bash
      run: docker compose up -d
    - name: Wait for Backend to be ready â±ï¸
      shell: bash
      run: |
        echo "Waiting for backend to be ready on port ${{ inputs.port }}..."
        until curl -s http://localhost:${{ inputs.port }}/ --fail-with-body
        do
          echo "Backend not ready yet, waiting..."
          sleep 5
        done
